# æœ¬å‘¨å®‰å…¨:åœ¨é‡Žå¤–ï¼Œé€šè¿‡ä½ çš„ NATï¼Œå‹‡æ•¢

> åŽŸæ–‡ï¼š<https://hackaday.com/2020/11/06/this-week-in-security-in-the-wild-through-your-nat-and-brave/>

æœ¬å‘¨çš„å¤§éƒ¨åˆ†æŠ¥é“éƒ½æ˜¯åœ¨è¡¥ä¸å‘å¸ƒå‰å°±è¢«åˆ é™¤çš„æ¼æ´žï¼Œå…¶ä¸­å¾ˆå¤šéƒ½è¢«åˆ©ç”¨äº†ã€‚ç³»å¥½å®‰å…¨å¸¦ï¼

### Windows å†…æ ¸åŠ å¯†

ç¬¬ä¸€ä¸ªæ˜¯ [CVE-2020-17087ï¼ŒWindows å†…æ ¸åŠ å¯†é©±åŠ¨](https://bugs.chromium.org/p/project-zero/issues/detail?id=2104)ä¸­çš„ä¸€ä¸ªé—®é¢˜ã€‚æ˜“å—æ”»å‡»çš„ç³»ç»Ÿè°ƒç”¨å¯ä»¥ä»Žéžç‰¹æƒç”¨æˆ·ç©ºé—´è®¿é—®ï¼Œç”šè‡³å¯èƒ½ä»Žæ²™ç›’çŽ¯å¢ƒå†…éƒ¨è®¿é—®ã€‚ç”±æ­¤äº§ç”Ÿçš„ç¼“å†²åŒºæº¢å‡ºå¯å¯¼è‡´åœ¨å†…æ ¸çŽ¯å¢ƒä¸­æ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿™æ„å‘³ç€è¿™æ˜¯å¯¹å—å®³ç³»ç»Ÿè¿›è¡Œæ ¹çº§æŽ§åˆ¶çš„å¿«é€Ÿè·³è½¬ã€‚

è¿™é‡Œè¢«æ”»å‡»çš„ä»£ç ç¼ºé™·åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä½äºŽäºŒè¿›åˆ¶åˆ°åå…­è¿›åˆ¶è½¬æ¢ä¾‹ç¨‹ä¸­çš„ä¸€ç‚¹ç¼“å†²åŒºåˆ†é…é€»è¾‘ä¸­ã€‚è¯¥å‡½æ•°æŽ¥å—æ— ç¬¦å·çš„çŸ­é•¿åº¦å‚æ•°ã€‚è¯¥å€¼ç”¨äºŽè®¡ç®—è¾“å‡ºç¼“å†²åŒºå¤§å°ï¼Œæ–¹æ³•æ˜¯å°†å…¶ä¹˜ä»¥ 6ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæ— ç¬¦å·çŸ­æ•´åž‹æ¥ä¿å­˜è¯¥å€¼ã€‚çœ‹åˆ°é—®é¢˜äº†å—ï¼Ÿè¶³å¤Ÿå¤§çš„å€¼å°†ä¼šç¿»è½¬ï¼Œè€Œè¾“å‡ºç¼“å†²åŒºçš„å¤§å°å°†ä¼šå¤ªå°ã€‚è¿™æ˜¯å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºçš„å€¼æº¢å‡ºã€‚

å› ä¸ºè¯¥é—®é¢˜æ­£è¢«ç§¯æžåˆ©ç”¨ï¼Œè¯¥æŠ¥å‘Šåœ¨å‘çŽ°åŽä»…ä¸ƒå¤©å°±è¢«å…¬ä¹‹äºŽä¼—ã€‚æˆªè‡³æœ¬æ–‡æ’°å†™ä¹‹æ—¶ï¼Œè¯¥æ¼æ´žä»æœªåœ¨ Windows 10 ä¸­æ‰“è¡¥ä¸ã€‚å®ƒä¼¼ä¹Žæ—©åœ¨ Windows 7 ä¸Šå°±å­˜åœ¨äº†ï¼Œç”±äºŽä¸æ”¯æŒï¼ŒWindows 7 å¯èƒ½ä¸ä¼šå¾—åˆ°ä¿®å¤ã€‚ã€ç¼–è€…åˆ»è–„æ³¨:è°¢è°¢ï¼Œé—­æºè½¯ä»¶ã€‚]

### è‹±ç‰¹å°”å¯†é’¥æå–

å‡ åå¹´æ¥ï¼Œå¾®ç ä¸€ç›´æ˜¯ CPU æž¶æž„çš„ä¸€éƒ¨åˆ†ã€‚ä»ŽæŸç§è§’åº¦æ¥çœ‹ï¼Œå¤„ç†å™¨æ€»æ˜¯æœ‰æŸç§å¾®ç â€”â€”å°†æŒ‡ä»¤è½¬æ¢æˆç¦»æ•£ç¡¬ä»¶æ“ä½œçš„é€»è¾‘ã€‚æ­£å¦‚æˆ‘ä»¬ä»Šå¤©æ‰€è®¤ä¸ºçš„ï¼Œå¾®ç æ˜¯éšå¥”è…¾ Pro ä¸€èµ·å‡ºçŽ°åœ¨ x86 å¤„ç†å™¨ä¸Šçš„ã€‚æœ‰äº†è¯¥å¤„ç†å™¨ï¼Œç»ˆäºŽå¯ä»¥åœ¨å¯åŠ¨æ—¶æ›´æ–°å¾®ç å±‚ï¼Œä¿®å¤åˆ¶é€ åŽå‘çŽ°çš„é”™è¯¯å’Œé—®é¢˜ã€‚è‹±ç‰¹å°”ä¸€ç›´å°†å¾®ç ä½œä¸ºåŠ å¯†çš„ blob åˆ†å‘ï¼Œä½¿ç ”ç©¶äººå‘˜æ— æ³•è°ƒæŸ¥æ›´æ–°ä¹‹é—´çš„å˜åŒ–ã€‚è¿™ä¸€é™åˆ¶å¯èƒ½ä¼šè¢«è§£é™¤ï¼Œå› ä¸ºä¸‰åç ”ç©¶äººå‘˜å·²ç»è®¾æ³•ä»ŽçŽ°ä»£è‹±ç‰¹å°” CPU ä¸­æå–å‡ºåŠ å¯†å¯†é’¥ã€‚

ç”±äºŽå­˜åœ¨å…è®¸è®¿é—®è‹±ç‰¹å°”èŠ¯ç‰‡å†…éƒ¨è°ƒè¯•æŽ¥å£çš„æ¼æ´žï¼Œè¯¥æå–æ˜¯å¯èƒ½çš„ã€‚è¿™ç§æŠ€æœ¯éœ€è¦ç‰©ç†æŽ¥è§¦æœºå™¨ï¼Œå¹¶ä¸”èŠ¯ç‰‡åœ¨ç”µæºå¾ªçŽ¯æ—¶é‡ç½®åˆ°å…¶å‡ºåŽ‚çŠ¶æ€ã€‚æ—¶é—´ä¼šå‘Šè¯‰æˆ‘ä»¬ä»Žè‹±ç‰¹å°”å¤„ç†å™¨çš„éšè—æ·±å¤„è¿˜ä¼šæŒ–æŽ˜å‡ºä»€ä¹ˆæœ‰è¶£çš„èŠ±çµ®ã€‚å…³æ³¨[èŠ¯ç‰‡çº¢ä¸¸åº“](https://github.com/chip-red-pill?tab=repositories)æ­£åœ¨è¿›è¡Œçš„å·¥ä½œã€‚

### è’é‡Žä¸­çš„ç¥žè°•

é’ˆå¯¹ Oracle äº§å“çš„ä¸¤ç§ç‹¬ç«‹æ”»å‡»æ­£åœ¨è¢«é¢‘ç¹ä½¿ç”¨ã€‚ç¬¬ä¸€ä¸ªæ˜¯ Weblogic ä¸­çš„ CVE-2020-14882ï¼Œ[ä¸€ä¸ªåªéœ€è¦ä¸€ä¸ª HTTP GET æ¥è§¦å‘](https://isc.sans.edu/forums/diary/PATCH+NOW+CVE202014882+Weblogic+Actively+Exploited+Against+Honeypots/26734/)çš„é¢„æŽˆæƒ RCEã€‚è¿™åœ¨æœ€æ–°çš„å®‰å…¨æ›´æ–°ä¸­å¾—åˆ°äº†ä¿®è¡¥ï¼Œ[å¾ˆå¿«å¯¹](https://testbnull.medium.com/weblogic-rce-by-only-one-get-request-cve-2020-14882-analysis-6e4b09981dbf)è¿›è¡Œäº†é€†å‘å·¥ç¨‹ã€‚(é‚£æ˜¯ç”¨è¶Šå—è¯­å†™çš„ã€‚è°·æ­Œç¿»è¯‘åšå¾—å¾ˆå¥½ï¼Œè¶³ä»¥è·Ÿè¿›ã€‚)

ç¬¬äºŒæ¬¡æ”»å‡»æ˜¯ [CVE-2020-14871ï¼Œç”²éª¨æ–‡ Solaris](https://www.zdnet.com/article/hacker-group-uses-solaris-zero-day-to-breach-corporate-networks/) ä¸­çš„ PAM æ¼æ´žã€‚è¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„é›¶æ—¥ï¼Œè¢«åˆ©ç”¨äº†å‡ ä¸ªæœˆæ‰åœ¨åŒä¸€å¥—å®‰å…¨æ›´æ–°ä¸­ä¿®å¤ã€‚ç«çœ¼å…¬å¸æ˜¯æœ€åˆå‘çŽ°æ”»å‡»çš„å…¬å¸ï¼Œ[ï¼Œå¹¶å¥½å¿ƒè§£é‡Šå®ƒ](https://www.fireeye.com/blog/threat-research/2020/11/critical-buffer-overflow-vulnerability-in-solaris-can-allow-remote-takeover.html)ã€‚å¯æ’æ‹”èº«ä»½éªŒè¯æ¨¡å—(PAM)æœ‰ä¸€ä¸ªæœ€å¤§å“åº”å¤§å°ï¼Œå¹¶ä½¿ç”¨è¯¥å¤§å°æž„å»ºä¸€ä¸ªç¼“å†²åŒºæ¥ä¿å­˜ä¼ å…¥çš„è¯·æ±‚ã€‚Solaris ä»£ç æ— æ³•å¯¹è¯·æ±‚è¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œå¦‚æžœè¾“å…¥å­—ç¬¦ä¸²å¤ªé•¿ï¼Œå®ƒåªæ˜¯ç®€å•åœ°å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­ï¼Œè¶…è¿‡äº†æœ«å°¾ã€‚

çŽ°åœ¨ï¼Œæ‚¨è®¤ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨å“ªé‡Œæ“ä½œ PAM è¯·æ±‚çš„è¾“å…¥æ¶ˆæ¯ï¼Ÿå®‰å…¨å¤–å£³å®ˆæŠ¤è¿›ç¨‹æ€Žä¹ˆæ ·ï¼Ÿæ˜¯çš„ï¼Œåœ¨é”®ç›˜äº¤äº’æ¨¡å¼ä¸‹å‘å‡º SSH è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨è¶…è¿‡ 512 ä¸ªå­—ç¬¦çš„ç”¨æˆ·åã€‚åœ¨ä¸€ä¸ªç®€å•çš„æµ‹è¯•ä¸­ï¼ŒPAM åªæ˜¯å´©æºƒäº†ï¼Œä½†æ˜¯æœ‰å¯èƒ½æ“çºµç”¨æˆ·åæ¥å±å®³æœºå™¨ã€‚

è¿™æ˜¯æœ€åçš„æƒ…å†µã€‚Solaris çš„ SSHD å®ˆæŠ¤ç¨‹åºçš„é»˜è®¤é…ç½®å®¹æ˜“å—åˆ°ç®€å•çš„æ”»å‡»ã€‚åªéœ€å°† SSH æš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œæ‚¨çš„æœºå™¨å°±å¯èƒ½å—åˆ°å¨èƒã€‚ä½¿ç”¨ SSH å¯†é’¥å¹¶ç¦ç”¨æ‰€æœ‰å…¶ä»– SSH ç™»å½•æ–¹æ³•ä¼¼ä¹Žå¯ä»¥å‡è½»è¿™ä¸ªæ¼æ´žï¼Œç‰¹åˆ«æ˜¯å¦‚æžœæ‚¨ç”šè‡³å®Œå…¨ç¦ç”¨ SSH PAM çš„è¯ã€‚OpenIndiana ä¸­ä¹Ÿå­˜åœ¨æ­¤æ¼æ´žã€‚2020.10 åº”è¯¥åŒ…å«ä¿®å¤ï¼Œä½†æˆ‘æ‰¾ä¸åˆ°ä»»ä½•å…³äºŽä¹‹å‰ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œ2020.04 æ­£åœ¨æ‰“è¡¥ä¸ã€‚é¡¾å®¢å°å¿ƒä¸Šå½“ã€‚

### å°å¿ƒ BMC

æˆ‘ä¸€ç›´å¯¹åŸºæ¿ç®¡ç†æŽ§åˆ¶å™¨(BMC)æŒæ€€ç–‘æ€åº¦ã€‚æ˜¯çš„ï¼Œèƒ½å¤Ÿè®¿é—®è¿œç¨‹è®¡ç®—æœºçš„ BIOS ç•Œé¢éžå¸¸æœ‰ç”¨ã€‚BMC ç”šè‡³å¯ä»¥ç”¨äºŽè¿œç¨‹é‡è£…æ•´ä¸ªæ“ä½œç³»ç»Ÿã€‚å¯¹äºŽä¸€å°è¢«é”åœ¨è¿œç¨‹æ•°æ®ä¸­å¿ƒçš„æœºå™¨æ¥è¯´ï¼ŒBMC å¯ä»¥æ‹¯æ•‘ç”Ÿå‘½ã€‚

BMC ä¹Ÿæ˜¯åœ¨æ‚¨çš„ç¡¬ä»¶ä¸Šè¿è¡Œçš„ç¬¬äºŒä¸ªæ“ä½œç³»ç»Ÿï¼Œæ‚¨æ— æ³•æŽ§åˆ¶å®ƒã€‚æˆ‘ä»Žæ¥éƒ½ä¸ä¹ æƒ¯æŠŠé‚£ä¸ªé»‘ç›’æ“ä½œç³»ç»Ÿè¿žæŽ¥åˆ°äº’è”ç½‘ä¸Šã€‚æˆ‘æœ‰ä¸€å¯¹æœåŠ¡å™¨ï¼Œæˆ‘åœ¨æ¯å°æœåŠ¡å™¨ä¸Šä½¿ç”¨äº†ä¸€ä¸ªè¾…åŠ©ä»¥å¤ªç½‘ç«¯å£ï¼Œä»Žæ¯å°æœåŠ¡å™¨äº¤å‰è¿žæŽ¥åˆ°å¦ä¸€å°æœåŠ¡å™¨çš„ BMC ç«¯å£ã€‚æˆ‘å¯ä»¥ SSH è¿›å…¥å¹¶è®¿é—®ç•Œé¢ï¼ŒåŒæ—¶ä¿æŒ BMC å®Œå…¨éš”ç¦»ã€‚äº‹å®žè¯æ˜Žï¼Œ[æˆ‘çš„åæ‰§æ˜¯å®Œå…¨æœ‰é“ç†çš„](https://www.securityweek.com/nvidia-patches-ami-bmc-vulnerabilities-impacting-several-major-vendors)ã€‚è¿™ç¯‡æ–‡ç« æ˜¯ä¸“é—¨é’ˆå¯¹ NVIDIA SCADA ç³»ç»Ÿçš„ï¼Œä½†è‡³å°‘å…¶ä¸­ä¸€äº›æ¼æ´žå­˜åœ¨äºŽè¿™ä¸ª BMC ç³»ç»Ÿçš„å…¶ä»–è¿­ä»£ä¸­ã€‚æœ€ç³Ÿç³•çš„è¿è§„è€…æ˜¯ CVE 202011483ï¼Œç¡¬ç¼–ç å‡­æ®ã€‚è¿™ç§ç±»åž‹çš„é”™è¯¯é€šå¸¸æ˜¯ä¸€ä¸ªè°ƒè¯•å¸æˆ·ï¼Œæœ‰äººåœ¨å‘å¸ƒå›ºä»¶ä¹‹å‰å¿˜è®°ç¦ç”¨ï¼Œå®ƒä»ç„¶æ˜¯ä»»ä½•è¿è¡Œæ­¤ BMC çš„ç³»ç»Ÿçš„ä¸»è¦åŽé—¨ã€‚å¤è€çš„æ ¼è¨€ä»ç„¶é€‚ç”¨:ä¸è¦æŠŠå®ƒè¿žæŽ¥åˆ°äº’è”ç½‘ä¸Šï¼

### è°·æ­Œçš„ Project Zero è¯¦ç»†ä»‹ç»äº† GitHub æ¼æ´ž

Project Zero å…¬å¸ƒäº† GitHub çš„ Actions ç³»ç»Ÿä¸­ä¸€ä¸ªç¼ºé™·çš„ç»†èŠ‚ã€‚æ‚¨å¯èƒ½å·²ç»ä¸ŽåŠ¨ä½œè¿›è¡Œäº†äº¤äº’â€”â€”å½“ä¸€ä¸ªé¡¹ç›®æ ¹æ®æ‹‰è¯·æ±‚è‡ªåŠ¨è¿è¡Œä¸€ä¸ªæµ‹è¯•å¥—ä»¶ï¼Œæˆ–è€…å°†æ–°çš„é”™è¯¯æŠ¥å‘Šå¤åˆ¶åˆ°å…¶ä»–å­˜å‚¨åº“æ—¶ï¼Œå®ƒå°±æ˜¯å¹•åŽçš„åŠ¨ä½œã€‚[è¯¥æ¼æ´žæ˜¯å‘½ä»¤æ³¨å…¥](https://bugs.chromium.org/p/project-zero/issues/detail?id=2070&can=2&q=&colspec=ID%20Type%20Status%20Priority%20Milestone%20Owner%20Summary&cells=ids)ã€‚Project Zero bug æŠ¥å‘ŠæŒ‡å‡º`set-env`å‘½ä»¤æ˜¯æœ€éº»çƒ¦çš„ï¼Œå› ä¸ºä»–ä»¬çš„ PoC åŒ…æ‹¬å‘é€åˆ°åº•å±‚èŠ‚ç‚¹æœåŠ¡å™¨çš„å‚æ•°ï¼Œæ‰€ä»¥æˆ‘å€¾å‘äºŽåŒæ„ã€‚

è¿™é‡Œçš„æ”¿æ²»è§’åº¦ä¹Ÿå¾ˆæœ‰è¶£ã€‚GitHub åœ¨æ”¶åˆ°æŠ¥å‘ŠåŽçš„ç¬¬ 103 å¤©çš„æœ€åŽä¸€åˆ»è¦æ±‚å»¶é•¿æŠ«éœ²æ—¶é—´ã€‚åœ¨ 10 æœˆ 1 æ—¥çš„è¾©æŠ¤ä¸­ï¼ŒGitHub çš„ç¡®å‘å¸ƒäº†ä¸€ä»½å…¬å‘Šï¼ŒæŠ«éœ²äº†é™¤ PoC ä»£ç ä¹‹å¤–çš„æ‰€æœ‰å†…å®¹ã€‚è¿™åªæ˜¯å…¶ä¸­ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€äº›ç”¨æˆ·çš„ä¸€ä¸ªç‰¹æ€§ã€‚å¦‚æžœæ‚¨ç®¡ç†ä¸€ä¸ªä½¿ç”¨åŠ¨ä½œçš„ GitHub é¡¹ç›®ï¼Œå¯èƒ½å€¼å¾—èŠ±ä¸€äº›æ—¶é—´æ¥ç¡®ä¿æ‚¨ä¸ä¼šå—åˆ°å‘½ä»¤æ³¨å…¥çš„æ”»å‡»ã€‚

### é€šè¿‡ NAT çš„æ»‘æµ

ä¸ç®¡ä½ å–œä¸å–œæ¬¢ï¼ŒNAT å·²ç»æˆä¸ºæˆ‘ä»¬ç½‘ç»œçš„ä¸€éƒ¨åˆ†å¾ˆå¤šå¹´äº†ã€‚ä¸ç®¡å®ƒæ˜¯å¦çœŸçš„æ˜¯é˜²ç«å¢™ï¼Œæˆ‘åŒæ„ç½—ä¼¯ç‰¹Â·æ ¼é›·åŽ„å§†çš„è§‚ç‚¹:

> åœ¨æ‰€æœ‰çš„å®‰å…¨ç‰¹æ€§ä¸­ï¼Œæ¯å¤©é˜»æ­¢æœ€å¤šç½‘ç»œæ”»å‡»/é»‘å®¢çš„ç¬¬ä¸€ä»¶äº‹æ˜¯â€¦ NATã€‚
> 
> â€”robáµ‰Ê³áµ—Â·æ ¼æ‹‰æ±‰å§†ðŸ˜·ï¼ŒæŒ‘è¡…è€…(@ ErrataRob)[2019 å¹´ 5 æœˆ 14 æ—¥](https://twitter.com/ErrataRob/status/1128091819965931520?ref_src=twsrc%5Etfw)